### 9. Стек блокчейн-технологий. Уровневая модель стека
Тема хорошо раскрыта в англоязычной [статье](https://cehv.com/cehvs-blockchain-osi-model-thesis/).

Введение:
* Широкое распространение блокчейн технологии возможно благодаря приложениям, которые будут абстрагировать пользователя от всех технологий и использовать тот протокол, который удобнее (также как это произошло с Интернетом - сейчас пользователь взаимодействует лишь с 7 уровнем Приложения сетевой модели OSI и не знает, что происходит на других уровнях стека, например ему все равно используется IPv4 или IPv6)
* Можно составить аналог OSI для бизнеса - где денежная оценка потенциала компании напрямую зависит от масштаба задач, которые она решает (есть крупные компании, которые управляют малым бизнесом, а есть мелкие компании, которые решает нишевую проблему для подмножества пользователей)
* Три сектора ценности потенциала:
  * Стимулирующие сектора
    * Они в основном состоят из физического уровня, уровня канала передачи данных и сетевого уровня
    * Пример компании: Verizon Communications
  * Сектора стандартов
    * Ценность определяется созданием единого стандарта внедрения и вспомогательных услуг на его основе
    * Пример компании: Adobe’s PDF
  * Секторы взаимодействия
    * Самые ценные - это технологические бренды и стартапы, с которыми пользователи часто взаимодействуют, причем взаимодействуют через приложения (то есть не задумываются, что за протоколы используются)
    * Примеры компаний: Microsoft, Amazon, Facebook
* Если создать гибридную модель OSI Блокчейна, можно понять куда нужно инвестировать

Модель OSI Блокчейна:
* 11-уровневая модель OSI Blockchain направлена на разделение **протоколов блокчейна** и **децентрализованных приложений** ("dApps") по уровням, которые представляют собой разделение как по **технологии**, так и по **назначению**
* Каждый из 11 уровней примерно (хотя и с выбросами) варьируется от:
  * самого низкого до самого высокого **уровней абстракции** для конечных пользователей (запущенные узлы по сравнению с использованием MetaMask) и 
  * самого низкого до самого высокого **уровней извлечения максимальной потенциальной ценности** (аппаратное обеспечение с низкой маржой, абстракция с высокой маржинальной платой за протоколы взаимодействия)
* Уровни (по возрастанию):
  1. **Физический** - инфраструктура
  2. **Канальный** - ПО физического уровня
  3. **Сетевой** - соединяет два любых физических узла
  * Микросетевой - состоит из используемого нами протокола блокчейна (например, Ethereum) и передачи данных между узлами по классическим интернет-протоколам сетевого уровня (TCP/IP)
  * Макросетевой - это инструменты и протоколы, которые соединяют узлы вместе
  4. **Информационный** - набор стандартов, процедур и протоколов того, как мы индексируем, храним и сортируем информацию
  5. **Обрабатывающий** - один из самых широких и разнообразных с точки зрения его конкретных конечных целей
  6. **Представления** - один из наиболее важных уровней для роста и развития открытой системы, и все же он часто является наиболее недофинансируемым, наименее прибыльным и наиболее забытым в любой модели систем
    * ERC-20, ERC-721, ERC-1155
  7. **Программный** - создает инструменты, которые мы используем для разработки, развертывания и управления программами прикладного уровня или уровня взаимодействия, часто используя для этого существующие стандарты уровня представления
  8. **Приложения** - это то место, где большинство пользователей взаимодействуют с реальными программами, использующими коллекции базовых протоколов.
  9. **Взаимодействия** - это специальные программные наборы инструментов, которые позволяют пользователям легко взаимодействовать с приложениями, а иногда и с протоколами более низкого уровня стека
    * Metamask
  10. **Платформы** - еще не был зафиксирован в пространстве блокчейна
  11. **Расчетный / регулирования (Settlement ?)** - абстрактный слой
  * это магистраль, соединяющая несколько слоев вместе
  * это универсальная истина, окончательность и безопасность (это то, чего не существует в классическом Интернете)

Итоги:
* На сегодняшний день проблема блокчейн сферы в том, что разработчики не могут предоставить пользователю понятный результат работы их приложения, а инвестировать в непонятную технологию, скрытую под капотом приложения не хочется.
* Понимая многоуровневые компоненты модели OSI Блокчейна и то, как они работают вместе, мы можем определить области для инвестиционных возможностей, области уязвимости / монополии, отраслевые пробелы и недостающие элементы, которые нужны, чтобы задать тренд на блокчейн-технологию.

---
### 23. Параметры ERC721, ERC1155, примеры программного кода
**NFT (non-fungible token, "невзаимозаменяемый токен")**
* С технологией NFT вы наверняка знакомы, если хоть раз регистрировали свои права на имущество, например, на квартиру или машину. Факт того, что вы – владелец имущества – **записывается в государственном реестре**, а если вы свое имущество продаете, то эта запись переходит покупателю.
* Похожим образом работает NFT: он **содержит информацию о своем создателе**, и с передачей этого токена другому лицу, например, покупателю, информация об авторском праве переходит новому владельцу.

**ERC721, ERC1155** - cтандарты, которые используются в NFTs – несменяемых токенах. Особенно удачно они работают в ситуациях, когда необходимо токенизировать единственный в своём роде актив.

**ERC-721** - это стандарт невзаимозаменяемого токена (NFT), написанный на языке Solidity в блокчейне Ethereum. Стандарт ERC-721 был создан Уильямом Энтрикеном, Дитером Ширли, Джейкобом Эвансом и Натассией Сакс в 2018 году. 

По сути, **каждый токен ERC-721 уникален** и представляет собой один актив. Более того, это позволяет разработчикам создавать совершенно новую экосистему токенов на блокчейне Ethereum.

Стандарт ERC-721 структурно напоминает ERC-20. Хотя смарт-контракты обоих токенов имеют несколько схожие функции, некоторые функции ERC-721 различаются.

Вот наиболее характерные **особенности ERC-721**:
* Имя токена
  * Каждый токен ERC-721 имеет поле имени, которое указывает имя токена **для внешних приложений** или контрактов
* Право собственности
  * Стандарт ERC-721 имеет определенное поле функций, которое определяет право собственности на базовый токен и дает указания о том, как передать это право собственности
* Отслеживание токенов
  * Стандарт ERC-721 имеет функцию под названием «tokenOfOwnerByIndex», которое позволяет разработчикам отслеживать токены с помощью уникального идентификатора

Пример контракта:
```c
pragma solidity ^0.5.0;

import "@openzeppelin/contracts/token/ERC721/ERC721Full.sol";
import "@openzeppelin/contracts/drafts/Counters.sol";

contract GameItem is ERC721Full {
    using Counters for Counters.Counter;
    Counters.Counter private _tokenIds;
    constructor() ERC721Full("GameItem", "ITM") public {
    }
    function awardItem(address player, string memory tokenURI) public returns (uint256) {
        _tokenIds.increment();
        uint256 newItemId = _tokenIds.current();
        _mint(player, newItemId);
        _setTokenURI(newItemId, tokenURI);
        return newItemId;
    }
}
```

**Стандарт ERC-1155** - улучшение одновременно и ERC-20, и ERC-721. Он позволяет **в одном и том же контракте** описывать как взаимозаменяемые, так и невзаимозаменяемые единицы.

Вот наиболее характерные **особенности ERC-1155**:
* Эффективный перевод
  * Стандарт ERC-1155 позволяет пользователям совершать массовые переводы токенов в рамках смарт-контракта
    * Пакетная передача: передача нескольких ресурсов за один вызов
    * Пакетный баланс: получите балансы нескольких активов за один вызов
    * Пакетное подтверждение: подтвердите все токены для адреса
* Несколько токенов в одном контракте
  * Каждый токен ERC-1155 описывает существование и работу как взаимозаменяемых, так и невзаимозаменяемых типов токенов
* Безопасная передача токенов
  * Стандарт токенов ERC-1155 включает функцию, которая проверяет, является ли транзакция действительной или нет
* Hooks
  * Хуки - это технология перехвата вызовов функций в чужих процессах
  * Функция hook возвращает предопределенное значение bytes4, когда смарт-контракт принимает передачу
* Поддержка NFT
  * Если источник только 1, то он рассматривается как NFT

Пример контракта:
```s
// contracts/GameItems.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.6.0;

import "@openzeppelin/contracts/token/ERC1155/ERC1155.sol";

contract GameItems is ERC1155 {
    uint256 public constant GOLD = 0;
    uint256 public constant SILVER = 1;
    uint256 public constant THORS_HAMMER = 2;
    uint256 public constant SWORD = 3;
    uint256 public constant SHIELD = 4;

    constructor() public ERC1155("https://game.example/api/item/{id}.json") {
        _mint(msg.sender, GOLD, 10**18, "");
        _mint(msg.sender, SILVER, 10**27, "");
        _mint(msg.sender, THORS_HAMMER, 1, "");
        _mint(msg.sender, SWORD, 10**9, "");
        _mint(msg.sender, SHIELD, 10**9, "");
    }
}
```

Полезные ссылки:
* [ERC 721](https://docs.openzeppelin.com/contracts/2.x/api/token/erc721)
* [ERC-1155 MULTI-TOKEN STANDARD](https://ethereum.org/en/developers/docs/standards/tokens/erc-1155/)